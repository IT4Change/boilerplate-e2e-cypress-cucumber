name: e2e:run:tests

on: push

jobs:
  e2e-tests:
    name: Run all E2E tests
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@master

      - name: E2E - Run all tests
        id: e2e-tests
        uses: cypress-io/github-action@v6

      - name: E2E | if tests failed, compile html report
        if: ${{ failure() && steps.e2e-tests.conclusion == 'failure' }}
        run: |
          cd cypress/
          node create-cucumber-html-report.js

      - name: E2E | if tests failed, upload report
        if: ${{ failure() && steps.e2e-tests.conclusion == 'failure' }}
        uses: actions/upload-artifact@v4
        with:
          name: boilerplate-e2e-test-report-pr${{ github.event.number }}
          path: /home/runner/work/boilerplate-e2e-cypress-cucumber/boilerplate-e2e-cypress-cucumber/cypress/reports/e2e_html_report
